<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>print() USB</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="text/javascript" src="../dist/receipt.js"></script>
<script type="text/javascript" src="../dist/receipt-printer.js"></script>
<script type="text/javascript" src="../dist/receipt-usb.js"></script>
<script type="text/javascript" src="./receipt-usb-console.js"></script>
<script type="text/javascript">

function initialize() {
    const markdown = document.querySelector('#markdown');
    const open = document.querySelector('#open');
    const print = document.querySelector('#print');
    const close = document.querySelector('#close');
    const body = document.querySelector('body');
    const log = msg => {
        const div = document.createElement('div');
        div.append(`${new Date().toISOString()} ${msg}`);
        body.append(div);
    };
    let conn = null;
    open.onclick = async () => {
        if (!conn) {
            conn = ReceiptUsbConsole.connect();
            conn.on('open', () => log('open'));
            conn.on('error', e => log(`error: ${e.message || e}`));
            conn.on('close', () => {
                log('close');
                conn = null;
            });
        }
    };
    print.onclick = async () => {
        if (conn) {
            const ok = await conn.print(markdown.value, '-c 42 -p generic');
            log(ok ? 'print ok' : 'print failed');
        }
    };
    close.onclick = () => {
        if (conn) {
            conn.close();
        }
    };
}
</script>
</head>
<body onload="initialize()">
<textarea rows="20" cols="80" id="markdown" title="markdown">^^^RECEIPT

03/18/2024, 12:34:56 PM
Asparagus | 1| 1.00
Broccoli  | 2| 2.00
Carrot    | 3| 3.00
---
^TOTAL | ^6.00</textarea>
<br>
<button id="open">Open USB</button>
<button id="print">Print</button>
<button id="close">Close</button>
<hr>
</body>
</html>
